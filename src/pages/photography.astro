---
import fs from "node:fs";
import path from "node:path";
import PageLayout from "@/layouts/Base.astro";

const meta = {
	description: "Photography and visual work by Suraj Sahu",
	title: "Portfolio",
};

const portfolioDir = path.join(process.cwd(), "public", "portfolio");
const imageFiles = fs.existsSync(portfolioDir)
	? fs
			.readdirSync(portfolioDir)
			.filter((f) => /\.(jpg|jpeg|png|webp|gif)$/i.test(f))
			.sort()
	: [];

// Reference layout: two columns (flex w-full md:w-1/2), items in each column are full or half width
const leftCol = imageFiles.filter((_, i) => i % 2 === 0);
const rightCol = imageFiles.filter((_, i) => i % 2 === 1);

function getItemWidthClass(index: number) {
	// Pattern: full, half, half, full, half, half...
	return index % 3 === 0 ? "w-full" : "w-full md:w-1/2";
}
---

<PageLayout meta={meta}>
	<div class="container mx-auto">
		<h1 class="pt-10 pb-8 text-4xl font-bold">PORTFOLIO</h1>
		<section class="text-neutral-700 dark:text-neutral-300">
			<div class="container w-full">
				<div class="flex w-full flex-wrap">
					<!-- Left column -->
					<div class="flex w-full flex-wrap md:w-1/2">
						{
							leftCol.map((filename, i) => {
								const thumbFilename = filename.replace(/\.(jpg|jpeg|png)$/i, ".webp");
								return (
									<div class={`p-1 ${getItemWidthClass(i)}`}>
										<div class="h-full w-full overflow-hidden">
											<a
												href={`/portfolio/${filename}`}
												target="_blank"
												rel="noopener noreferrer"
												class="focus:ring-offset-global-bg dark:focus:ring-accent block focus:ring-2 focus:ring-offset-2"
											>
												<img
													src={`/portfolio-thumbs/${thumbFilename}`}
													alt={filename.replace(/\.[^.]+$/, "").replace(/[-_]/g, " ")}
													class="animate-fade-in block h-full w-full scale-100 transform object-cover object-center opacity-0 transition duration-500 hover:scale-110"
													loading="lazy"
													decoding="async"
													width="800"
													height="600"
												/>
											</a>
										</div>
									</div>
								);
							})
						}
					</div>
					<!-- Right column -->
					<div class="flex w-full flex-wrap md:w-1/2">
						{
							rightCol.map((filename, i) => {
								const thumbFilename = filename.replace(/\.(jpg|jpeg|png)$/i, ".webp");
								return (
									<div class={`p-1 ${getItemWidthClass(i)}`}>
										<div class="h-full w-full overflow-hidden">
											<a
												href={`/portfolio/${filename}`}
												target="_blank"
												rel="noopener noreferrer"
												class="focus:ring-offset-global-bg dark:focus:ring-accent block focus:ring-2 focus:ring-offset-2"
											>
												<img
													src={`/portfolio-thumbs/${thumbFilename}`}
													alt={filename.replace(/\.[^.]+$/, "").replace(/[-_]/g, " ")}
													class="animate-fade-in block h-full w-full scale-100 transform object-cover object-center opacity-0 transition duration-500 hover:scale-110"
													loading="lazy"
													decoding="async"
													width="800"
													height="600"
												/>
											</a>
										</div>
									</div>
								);
							})
						}
					</div>
				</div>
			</div>
		</section>
	</div>

	{
		imageFiles.length === 0 && (
			<div class="container mx-auto px-5 md:px-20">
				<p class="text-global-text/80 text-sm">
					Add photos to{" "}
					<code class="rounded bg-gray-200 px-1 dark:bg-gray-700">public/portfolio/</code> to see
					them here.
				</p>
			</div>
		)
	}
</PageLayout>
