---
import { cvPage } from "@/data/pages/cv";
import PageLayout from "@/layouts/Base.astro";

const meta = {
	description: "Curriculum Vitae - Suraj Sahu",
	title: "CV",
};

type ExperienceEntry = (typeof cvPage.experience)[number];
function isProjectEntry(entry: ExperienceEntry): entry is ExperienceEntry & { project: string } {
	return "project" in entry && entry.project != null;
}
---

<PageLayout meta={meta}>
	<h1 class="title mb-12">Curriculum Vitae</h1>
	<div class="prose prose-sm prose-cactus max-w-none">
		<p class="mb-6">View my full CV or the condensed resume:</p>
		<div class="flex flex-wrap gap-3">
			{
				cvPage.pdfLinks.map((link) => (
					<a
						class="cactus-link hover:bg-accent hover:text-accent-fg inline-block rounded-lg border border-current px-6 py-3 text-center font-medium"
						href={link.href}
						target="_blank"
						rel="noopener noreferrer"
					>
						{link.label}
					</a>
				))
			}
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Education</h2>
			{
				cvPage.education.map((item) => (
					<div class="mb-6">
						<h3 class="font-semibold">
							{"institutionUrl" in item && item.institutionUrl ? (
								<a class="cactus-link" href={item.institutionUrl} target="_blank" rel="noopener noreferrer">
									{item.institution}
								</a>
							) : (
								item.institution
							)}
						</h3>
						<p class="text-sm opacity-75">{item.role}</p>
						<p class="text-sm opacity-75">
							{item.period}
							{"location" in item && item.location ? ` 路 ${item.location}` : ""}
						</p>
					</div>
				))
			}
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Skills</h2>
			<ul class="list-inside list-disc space-y-1">
				{cvPage.skills.map((s) => (
					<li>
						<strong>{s.category}:</strong> {s.items}
					</li>
				))}
			</ul>
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Publications</h2>
			<ul class="list-inside list-disc space-y-2">
				{cvPage.publications.map((p) => (
					<li>
						{p.authors}. {p.url ? (
							<a class="cactus-link" href={p.url} target="_blank" rel="noopener noreferrer">
								{p.title}
							</a>
						) : (
							p.title
						)}
						. <em>{p.journal}</em>, {p.vol}.
					</li>
				))}
			</ul>
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Professional Experience</h2>
			{
				cvPage.experience.map((entry) => (
					<div class="mb-8">
						{isProjectEntry(entry) ? (
							<>
								<h3 class="font-semibold">
									{"projectUrl" in entry && entry.projectUrl ? (
										<a class="cactus-link" href={entry.projectUrl} target="_blank" rel="noopener noreferrer">
											{entry.project}
										</a>
									) : (
										entry.project
									)}
									{"tech" in entry && entry.tech ? <span class="font-normal text-sm opacity-80"> 路 {entry.tech}</span> : null}
								</h3>
								<p class="text-sm opacity-75">{entry.period}</p>
							</>
						) : (
							<>
								<h3 class="font-semibold">
									{"orgUrl" in entry && entry.orgUrl ? (
										<a class="cactus-link" href={entry.orgUrl} target="_blank" rel="noopener noreferrer">
											{"role" in entry ? entry.role : ""}
										</a>
									) : (
										"role" in entry ? entry.role : ""
									)}
								</h3>
								{("org" in entry && entry.org) || ("location" in entry && entry.location) ? (
									<p class="text-sm opacity-75">
										{"org" in entry && entry.org ? (
											"orgUrl" in entry && entry.orgUrl ? (
												<a class="cactus-link" href={entry.orgUrl} target="_blank" rel="noopener noreferrer">
													{entry.org}
												</a>
											) : (
												(entry as { org?: string }).org ?? ""
											)
										) : null}
										{"location" in entry && entry.location ? ("org" in entry && entry.org ? " 路 " : "") + entry.location : ""}
									</p>
								) : null}
								<p class="text-sm opacity-75">{entry.period}</p>
							</>
						)}
						<ul class="mt-2 list-inside list-disc space-y-1 text-sm">
							{entry.items.map((item) => (
								<li>{item}</li>
							))}
						</ul>
					</div>
				))
			}
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Leadership & Campus Involvement</h2>
			{
				cvPage.leadership.map((item) => (
					<div class="mb-6">
						<h3 class="font-semibold">
							{"orgUrl" in item && item.orgUrl ? (
								<a class="cactus-link" href={item.orgUrl} target="_blank" rel="noopener noreferrer">
									{"org" in item ? item.org : ""}
								</a>
							) : (
								(item as { org?: string }).org ?? ""
							)}
							<span class="font-normal text-sm opacity-80"> 路 {item.role}</span>
						</h3>
						<p class="text-sm opacity-75">{item.period}</p>
						<ul class="mt-2 list-inside list-disc space-y-1 text-sm">
							{item.items.map((bullet) => (
								<li>{bullet}</li>
							))}
						</ul>
					</div>
				))
			}
		</div>

		<div class="mt-12">
			<h2 class="mb-4 text-xl">Relevant Coursework</h2>
			<ul class="list-inside list-disc columns-1 gap-4 sm:columns-2 md:columns-3">
				{cvPage.coursework.map((course) => (
					<li>{course}</li>
				))}
			</ul>
		</div>
	</div>
</PageLayout>
